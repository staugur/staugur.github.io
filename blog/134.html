<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Hiroshi.tao"><meta name=description content="一念博客，陶先森の博客，IT博客，技术记录与分享，开源项目与文档"><meta name=keywords content="SaintIC,Hiroshi.tao,Blog,博客,Linux,DevOps,sys,python,go,js,vue,flask,picbed,sapic,Flask-PluginKit,rtfd"><link rel=prev href=https://blog.saintic.com/blog/122.html><link rel=next href=https://blog.saintic.com/blog/138.html><link rel=canonical href=https://blog.saintic.com/blog/134.html><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>程序文档之Passport | 一念博客</title><meta name=title content="程序文档之Passport | 一念博客"><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.saintic.com"},"articleSection":"blog","name":"程序文档之Passport","headline":"程序文档之Passport","description":"Passport 请注意：此程序已经过重构，依赖此程序的其他程序若出现认证异常，烦请联系我修改，邮箱staugur@saintic.com。 程序描述：Uni","inLanguage":"zh-cn","author":"Hiroshi.tao","creator":"Hiroshi.tao","publisher":"Hiroshi.tao","accountablePerson":"Hiroshi.tao","copyrightHolder":"Hiroshi.tao","copyrightYear":"2016","datePublished":"2016-11-23 00:00:00 \u002b0000 UTC","dateModified":"2016-11-23 00:00:00 \u002b0000 UTC","url":"https:\/\/blog.saintic.com\/blog\/134.html","wordCount":"1613","keywords":["一念博客"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-back2home-logo"><span class=logo_mark>>$</span>
<a href=https://blog.saintic.com><span class=logo_text>cd /home/</span>
<span class=logo_cursor></span></a></div><div class=navbar-right><span class=menu><a class=menu-item href=/blog.html title>Blog</a>
<a class=menu-item href=/note.html title>Note</a>
<a class=menu-item href=/categories.html title>Categories</a>
<a class=menu-item href=/tags.html title>Tags</a>
<a class=menu-item href=/link.html title>Links</a>
<a class=menu-item href="https://www.baidu.com/s?wd=site:blog.saintic.com+" title>Baidu</a>
<a class=menu-item href="https://www.google.com/search?q=site:blog.saintic.com+" title>Google</a>
<a class=menu-item href=/about.html title=About>About</a>
<span class=divide></span>
<a href=javascript:void(0); class=theme-switch><i class="saintic-icon saintic-icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://blog.saintic.com>一念博客</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="saintic-icon saintic-icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=/blog.html title><h3>Blog</h3><div class=menu-active></div></a><a class=menu-item href=/note.html title><h3>Note</h3><div class=menu-active></div></a><a class=menu-item href=/categories.html title><h3>Categories</h3><div class=menu-active></div></a><a class=menu-item href=/tags.html title><h3>Tags</h3><div class=menu-active></div></a><a class=menu-item href=/link.html title><h3>Links</h3><div class=menu-active></div></a><a class=menu-item href="https://www.baidu.com/s?wd=site:blog.saintic.com+" title><h3>Baidu</h3><div class=menu-active></div></a><a class=menu-item href="https://www.google.com/search?q=site:blog.saintic.com+" title><h3>Google</h3><div class=menu-active></div></a><a class=menu-item href=/about.html title=About><h3>About</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><div class=toc><div class=page-header><strong>- 目录 -</strong></div><div id=page-scrollspy class=toc-nav><ul class=nav><ul class=nav><ul class=nav><ul class=nav><li class=nav-item><a class="nav-link text-left" href=#%3ch4%3e%3cb%20style%3d%22background-color%3a%20rgb%280%2c%20128%2c%200%29%3b%22%3e1.%20%e4%b8%8b%e8%bd%bd%e5%ae%89%e8%a3%85%3c%2fb%3e%3c%2fh4%3e>1. 下载安装</a></li></ul></ul></ul></ul><ul class=nav><ul class=nav><ul class=nav><ul class=nav><li class=nav-item><a class="nav-link text-left" href=#%3ch4%3e%3cb%20style%3d%22background-color%3a%20rgb%280%2c%20255%2c%20255%29%3b%22%3e2.%e7%a8%8b%e5%ba%8f%e5%87%86%e5%a4%87%3c%2fb%3e%3c%2fh4%3e>2.程序准备</a></li></ul></ul></ul></ul><ul class=nav><ul class=nav><ul class=nav><ul class=nav><li class=nav-item><a class="nav-link text-left" href=#%3ch4%3e%3cspan%20style%3d%22background-color%3a%20rgb%28255%2c%200%2c%200%29%3b%22%3e3.%20%e8%bf%90%e8%a1%8c%e4%bd%bf%e7%94%a8%3c%2fspan%3e%3c%2fh4%3e>3. 运行使用</a></li></ul></ul></ul></ul><ul class=nav><ul class=nav><ul class=nav><ul class=nav><li class=nav-item><a class="nav-link text-left" href=#%3ch4%3e%3cspan%20style%3d%22background-color%3a%20rgb%280%2c%200%2c%20128%29%3b%22%3e%3cfont%20color%3d%22%23ffffff%22%3e4.%20%e5%ae%a2%e6%88%b7%e7%ab%af%3c%2ffont%3e%3c%2fspan%3e%3c%2fh4%3e>4. 客户端</a></li></ul></ul></ul></ul></div></div><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">程序文档之Passport</h1><div class=post-meta>Written by <a itemprop=name href=https://blog.saintic.com rel=author>Hiroshi.tao</a> with ♥
<span class=post-time>on <time datetime=2016-11-23 itemprop=datePublished>November 23, 2016</time></span>
in
<i class="saintic-icon saintic-icon-folder"></i>
<span class=post-category><a href=https://blog.saintic.com/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE.html>开源项目</a></span>
<span class=post-word-count>1613 words</span></div></header><div class=post-content><p></p><p><span style=color:inherit;font-family:inherit;font-size:36px>Passport</span><br></p><blockquote><p>请注意：此程序已经过重构，依赖此程序的其他程序若出现认证异常，烦请联系我修改，邮箱staugur@saintic.com。</p></blockquote><p><b>程序描述：</b>Unified authentication and authorization management SSO system for SaintIC Web &nbsp;Applications.</p><p><b>代码仓库：</b><a href=https://github.com/staugur/passport target=_blank>https://github.com/staugur/passport</a></p><blockquote><p><b><font size=3>详细文档：<a href=http://docs.saintic.com/passport/install.html target=_blank>http://docs.saintic.com/passport/install.html</a></font></b></p></blockquote><p><i>以下是简略型文档：</i></p><h4><b style=background-color:green>1. 下载安装</b></h4><pre style=max-width:100%><code class="bash hljs" codemark=1>1.0 yum install -y gcc gcc-c++ python-devel libffi-devel openssl-devel mysql-devel
<span class=hljs-comment>#开发版本体验</span>
1.1 git <span class=hljs-built_in>clone</span> https://github.com/staugur/passport &amp;&amp;\
    <span class=hljs-built_in>cd</span> passport
<span class=hljs-comment>#稳定版本体验</span>
1.1 wget -c -O passport-1.0.3.tar.gz https://codeload.github.com/staugur/passport/tar.gz/v1.0.3 &amp;&amp;\
    tar zxf passport-1.0.3.tar.gz &amp;&amp;\
    <span class=hljs-built_in>cd</span> passport-1.0.3/
<span class=hljs-comment>#</span>
1.2 pip install -r requirements.txt</code></pre><p>如果git没有安装，那么执行yum -y install git</p><p>如果pip没有安装，那么执行yum -y install python-pip(没有python-pip，可先yum -y install epel-release)</p><p><br></p><h4><b style=background-color:#0ff>2.程序准备</b></h4><p><i>2.1 修改配置文件config.py(必要选项)</i></p><p>2.2 创建库，要求utf8,utf8_unicode_ci</p><p><i>2.3 写入数据库</i></p><p>使用工具或command line导入misc/passport.sql文件</p><p><br></p><h4><span style=background-color:red>3. 运行使用</span></h4><p><i>3.1 sh online_gunicorn.sh start|stop|restart|status</i></p><h1 id=h1-license><a name=LICENSE class="referen
ce-link"></a></h1><p><i>3.2 supervisord</i></p><pre style=max-width:100%><code class="ini hljs" codemark=1><span class=hljs-section>[program:passport]</span>
<span class=hljs-attr>command</span>=<span style=font-size:inherit>gunicorn&nbsp;-w&nbsp;$cpu_count&nbsp;--threads&nbsp;16&nbsp;-b&nbsp;${host}:${port}&nbsp;main:app&nbsp;-k&nbsp;gevent&nbsp;--log-file&nbsp;$logfile&nbsp;--max-requests&nbsp;250&nbsp;--name&nbsp;$procname #变量自行修改，未测试</span>
directory=程序src目录
<span class=hljs-attr>autostart</span>=<span class=hljs-literal>true</span>
<span class=hljs-attr>autorestart</span>=<span class="h
ljs-literal">true</span>
<span class=hljs-attr>startsecs</span>=<span class=hljs-number>5</span>
<span class=hljs-attr>priority</span>=<span class=hljs-number>1</span>
<span class=hljs-attr>stopasgroup</span>=<span class=hljs-literal>true</span>
<span class=hljs-attr>killasgroup</span>=<span class=hljs-literal>true</span></code></pre><p><i>3.3 docker(</i>参考详细文档<i>)</i></p><p><i>3.4 开发启用</i></p><p><i>&nbsp; &nbsp; python main.py</i></p><p><i><b>3.5 建立管理员账号(！！！)</b></i></p><p><i>&nbsp; &nbsp; 3.5.1 执行命令 <code>python cli.py --createSuperuser</code> 根据提示可以创建管理员用户。</i></p><p><i><br></i></p><h4><span style=background-color:navy><font color=#ffffff>4. 客户端</font></span></h4><blockquote><p>目前基于passport认证的项目有：<a href=https://github.com/staugur/EauDouce target=_blank>EauDouce</a>,&nbsp;<a href=https://github.com/staugur/CherryWaterfall target=_blank>CherryWaterfall</a>, <a href=https://github.com/staugur/IncetOps target=_blank>IncetOps</a></p><p>上述项目中，EauDouce(本站，<a href=https://blog.saintic.com target=_blank><span>blog.</span><span>saintic.com</span></a>)、IncetOps(<a target=_blank href=http://incetops.demo.saintic.com/>incetops.demo.saintic.com</a>)为作者官方网站，可以使用https://passport.saintic.com提供的服务，其他情况需要您单独部署passport项目。</p></blockquote><p>&nbsp; &nbsp; passport代码里有一个demo目录，是一个演示用的客户端程序，关于使用方法说明如下，其他客户端程序类似：</p><p>&nbsp; &nbsp; 1. 修改配置文件config.py</p><p>&nbsp; &nbsp; &nbsp; &nbsp; <b>1.1 主要是SSO段的配置，它的信息来自于passport应用管理中</b>(请参考本文1、2、3步骤部署，假设部署完成，域名是http://passport.demo.com)。</p><p>&nbsp; &nbsp; &nbsp; &nbsp; 登录passport.demo.com，管理员方能看见应用管理导航，点击进入，可以看到右侧有应用列表和新建应用两个标签页，点击新建应用，如图：</p><p>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<img src=https://static.saintic.com/EauDouce/blog/201808091029114480.png alt=1 style=max-width:100%></p><p>&nbsp; &nbsp; &nbsp; &nbsp; <u>如图，新建应用所需参数解释如下：</u></p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 名称：对应了客户端程序config.py中GLOBAL段ProcessName值(此为默认)，也可以自定义(需修改客户端config.py中SSO段app_name)；</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 描述：无实际意义，只是描述此应用作业；</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 回调域名：对应了客户端程序运行的地址，需要完全合格域名，比如http://eaudouce.demo.com，也可以是IP:PORT形式的，请注意域名需要连通的(DNS有解析或hosts有绑定)！</p><p>&nbsp; &nbsp; &nbsp; &nbsp; <u>点击提交即可，注意上述信息都是客户端的，提交后在应用列表查看应用详情，客户端SSO配置段主要需要以下项：</u></p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 应用名：客户端程序config.py中SSO段的app_name，SSO中注册的应用名称；</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; app_id：客户端程序config.py中SSO段的app_id；</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; app_secret：客户端程序config.py中SSO段的app_secret；</p><p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 此外客户端config.py中SSO段中还有一个sso_server，即passport的完全合格域名，即假设的http://passport.demo.com。</p><p>&nbsp; &nbsp; &nbsp; &nbsp; 1.2 MYSQL、REDIS，看客户端程序需要</p><p>&nbsp; &nbsp; &nbsp; &nbsp; <b>1.3 SYSTEM段，主要是HMAC_SHA256_KEY、AES_CBC_KEY、JWT_SECRET_KEY，要求值与passport中一致。</b></p><p>&nbsp; &nbsp; 2. 运行测试使用</p><p>&nbsp; &nbsp; &nbsp; &nbsp; python main.py</p><p><br></p><p></p><p><br></p><br><center>·End·</center></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Hiroshi.tao</span></p><p class=copyright-item><span>Link:</span>
<a href=https://blog.saintic.com/blog/134.html>https://blog.saintic.com/blog/134.html</span></p><p class="copyright-item lincese">本文采用 <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a> 进行许可</p></div><div class=post-tags><section><i class="saintic-icon saintic-icon-tag"></i>Tag(s):
（无）</section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://blog.saintic.com>home</a></span></section></div><div class=post-nav><a href=https://blog.saintic.com/blog/122.html class=prev rel=prev title=Docker程序之JAVA时区和日志乱码问题><i class="saintic-icon saintic-icon-angle-left"></i>&nbsp;Docker程序之JAVA时区和日志乱码问题</a>
<a href=https://blog.saintic.com/blog/138.html class=next rel=next title=介绍一款Markdown富文本编辑器——Editor.md>介绍一款Markdown富文本编辑器——Editor.md&nbsp;<i class="saintic-icon saintic-icon-angle-right"></i></a></div><div class=post-comment><div id=utteranc-container><script src=https://utteranc.es/client.js repo=staugur/staugur.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2025</span>
<span class=with-love><i class="saintic-icon saintic-icon-love"></i></span>
<span class=author itemprop=copyrightHolder><a href=https://blog.saintic.com>Hiroshi.tao</a> |</span>
<a href=https://beian.miit.gov.cn/ target=_blank rel="external nofollow">京ICP备14058611号-1</a> |
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/SaintIC/Mogege target=_blank rel="external nofollow">Mogege</a></span>
<span>| <a href=https://www.foreverblog.cn/go.html target=_blank title=穿梭虫洞-随机访问十年之约友链博客>虫洞</span></div></footer><script defer src=/js/vendor_main.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script>
<script>pangu.spacingPage()</script><script defer src=https://blog.saintic.com/js/my.js></script></div></body></html>