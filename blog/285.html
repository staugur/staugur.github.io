<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Hiroshi.tao"><meta name=description content="Hiroshi.tao の 网络日志"><meta name=keywords content="SaintIC,staugur,Linux,DevOps,sys,python,go,js,vue,picbed,sapic,Flask-PluginKit,rtfd"><link rel=prev href=https://blog.saintic.com/blog/284.html><link rel=next href=https://blog.saintic.com/blog/286.html><link rel=canonical href=https://blog.saintic.com/blog/285.html><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>分享：通过用户脚本上传网站图片到你的图床 | 陶先森de博客</title><meta name=title content="分享：通过用户脚本上传网站图片到你的图床 | 陶先森de博客"><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.saintic.com"},"articleSection":"blog","name":"分享：通过用户脚本上传网站图片到你的图床","headline":"分享：通过用户脚本上传网站图片到你的图床","description":"概述 此用户脚本来源于picbed（sapic）的一项特有功能，实现在Web中，通过在图片上“按键\u002b右击”显示上传按钮，上传到Web图床！ 考虑","inLanguage":"zh-cn","author":"Hiroshi.tao","creator":"Hiroshi.tao","publisher":"Hiroshi.tao","accountablePerson":"Hiroshi.tao","copyrightHolder":"Hiroshi.tao","copyrightYear":"2020","datePublished":"2020-08-14 00:00:00 \u002b0000 UTC","dateModified":"2020-08-14 00:00:00 \u002b0000 UTC","url":"https:\/\/blog.saintic.com\/blog\/285.html","wordCount":"2268","keywords":["js","陶先森de博客"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-back2home-logo"><span class=logo_mark>>$</span>
<a href=https://blog.saintic.com><span class=logo_text>cd /home/</span>
<span class=logo_cursor></span></a></div><div class=navbar-right><span class=menu><a class=menu-item href=/blog.html title>Posts</a>
<a class=menu-item href=/categories.html title>Categories</a>
<a class=menu-item href=/tags.html title>Tags</a>
<a class=menu-item href=/link.html title>Links</a>
<a class=menu-item href="https://www.baidu.com/s?wd=site:blog.saintic.com+" title>Search</a>
<a class=menu-item href=/about.html title=About>About</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="saintic-icon saintic-icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://blog.saintic.com>陶先森de博客</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="saintic-icon saintic-icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=/blog.html title><h3>Posts</h3><div class=menu-active></div></a><a class=menu-item href=/categories.html title><h3>Categories</h3><div class=menu-active></div></a><a class=menu-item href=/tags.html title><h3>Tags</h3><div class=menu-active></div></a><a class=menu-item href=/link.html title><h3>Links</h3><div class=menu-active></div></a><a class=menu-item href="https://www.baidu.com/s?wd=site:blog.saintic.com+" title><h3>Search</h3><div class=menu-active></div></a><a class=menu-item href=/about.html title=About><h3>About</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">分享：通过用户脚本上传网站图片到你的图床</h1><div class=post-meta>Written by <a itemprop=name href=https://blog.saintic.com rel=author>Hiroshi.tao</a> with ♥
<span class=post-time>on <time datetime=2020-08-14 itemprop=datePublished>August 14, 2020</time></span>
in
<i class="saintic-icon saintic-icon-folder"></i><span class=post-category><a href=https://blog.saintic.com/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE.html>开源项目</a></span>
<span class=post-word-count>2268 words</span></div></header><div class=post-content><section id=nice data-tool=mdnice编辑器 data-website=https://www.mdnice.com style="font-size:16px;padding:0 10px;word-spacing:0;word-break:break-word;word-wrap:break-word;text-align:left;line-height:1.25;color:#2b2b2b;font-family:Optima-Regular,Optima,PingFangTC-Light,PingFangSC-light,PingFangTC-light;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,4%) 3%,transparent 3%),linear-gradient(360deg,rgba(50,0,0,4%) 3%,transparent 3%);background-size:20px 20px;background-position:50%"><h3 data-tool=mdnice编辑器 style=padding:0;color:#000;font-size:17px;font-weight:700;text-align:center;position:relative;margin-top:20px;margin-bottom:20px><span class=prefix style=display:none></span><span class=content style="border-bottom:2px solid RGBA(79,177,249,.65);color:#2b2b2b;padding-bottom:2px"><span style=width:30px;height:30px;display:block;background-image:url(https://my-wechat.mdnice.com/fullstack-2.png);background-position:50%;background-size:30px;margin:auto;opacity:1;background-repeat:no-repeat;margin-bottom:-8px></span>概述</span><span class=suffix style=display:none></span></h3><p data-tool=mdnice编辑器 style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#2b2b2b;margin:10px 0;letter-spacing:2px;font-size:14px;word-spacing:2px">此用户脚本来源于<a href=https://github.com/staugur/picbed style="text-decoration:none;word-wrap:break-word;color:#40b8fa;font-weight:400;border-bottom:1px solid #3baafa">picbed（sapic）</a>的一项特有功能，实现在Web中，通过在图片上“按键+右击”显示上传按钮，上传到Web图床！</p><p data-tool=mdnice编辑器 style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#2b2b2b;margin:10px 0;letter-spacing:2px;font-size:14px;word-spacing:2px">考虑到其他用户可能有此需求，故将此部分拎出来分享。</p><h3 data-tool=mdnice编辑器 style=padding:0;color:#000;font-size:17px;font-weight:700;text-align:center;position:relative;margin-top:20px;margin-bottom:20px><span class=prefix style=display:none></span><span class=content style="border-bottom:2px solid RGBA(79,177,249,.65);color:#2b2b2b;padding-bottom:2px"><span style=width:30px;height:30px;display:block;background-image:url(https://my-wechat.mdnice.com/fullstack-2.png);background-position:50%;background-size:30px;margin:auto;opacity:1;background-repeat:no-repeat;margin-bottom:-8px></span>要求</span><span class=suffix style=display:none></span></h3><ul data-tool=mdnice编辑器 style=margin-top:8px;margin-bottom:8px;padding-left:25px;font-size:15px;color:#595959;list-style-type:circle><li><section style=margin-top:5px;margin-bottom:5px;line-height:26px;text-align:left;font-size:14px;font-weight:400;color:#595959><p style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#2b2b2b;margin:10px 0;letter-spacing:2px;font-size:14px;word-spacing:2px">你的Web图床有API上传接口且支持url方式上传</p><p style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#2b2b2b;margin:10px 0;letter-spacing:2px;font-size:14px;word-spacing:2px">即提交图片url地址，你的图床可以直接下载保存。</p></section></li><li><section style=margin-top:5px;margin-bottom:5px;line-height:26px;text-align:left;font-size:14px;font-weight:400;color:#595959><p style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#2b2b2b;margin:10px 0;letter-spacing:2px;font-size:14px;word-spacing:2px">匿名上传或允许在Header设置 <code style="font-size:14px;word-wrap:break-word;margin:0 2px;background-color:rgba(27,31,35,5%);font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;word-break:break-all;color:#3594f7;background:RGBA(59,170,250,.1);padding:0 2px;border-radius:2px;height:21px;line-height:22px">Authorization: Token &lt;密钥></code> 作为登录用户上传</p></section></li></ul><h3 data-tool=mdnice编辑器 style=padding:0;color:#000;font-size:17px;font-weight:700;text-align:center;position:relative;margin-top:20px;margin-bottom:20px><span class=prefix style=display:none></span><span class=content style="border-bottom:2px solid RGBA(79,177,249,.65);color:#2b2b2b;padding-bottom:2px"><span style=width:30px;height:30px;display:block;background-image:url(https://my-wechat.mdnice.com/fullstack-2.png);background-position:50%;background-size:30px;margin:auto;opacity:1;background-repeat:no-repeat;margin-bottom:-8px></span>使用说明</span><span class=suffix style=display:none></span></h3><p data-tool=mdnice编辑器 style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#2b2b2b;margin:10px 0;letter-spacing:2px;font-size:14px;word-spacing:2px">这是一段用户脚本，依赖于浏览器的Tampermonkey扩展（此类型的其他扩展实现不一定支持，比如暴力猴）。</p><p data-tool=mdnice编辑器 style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#2b2b2b;margin:10px 0;letter-spacing:2px;font-size:14px;word-spacing:2px">其效果和限制条件请参考<a href=https://picbed.rtfd.vip/usage.html#userscript style="text-decoration:none;word-wrap:break-word;color:#40b8fa;font-weight:400;border-bottom:1px solid #3baafa">picbed-userscript文档</a>（除效果、限制外，其他是picbed图床程序才有的功能开启设置，忽略它）。</p><h3 data-tool=mdnice编辑器 style=padding:0;color:#000;font-size:17px;font-weight:700;text-align:center;position:relative;margin-top:20px;margin-bottom:20px><span class=prefix style=display:none></span><span class=content style="border-bottom:2px solid RGBA(79,177,249,.65);color:#2b2b2b;padding-bottom:2px"><span style=width:30px;height:30px;display:block;background-image:url(https://my-wechat.mdnice.com/fullstack-2.png);background-position:50%;background-size:30px;margin:auto;opacity:1;background-repeat:no-repeat;margin-bottom:-8px></span>源码</span><span class=suffix style=display:none></span></h3><p data-tool=mdnice编辑器 style="padding-top:8px;padding-bottom:8px;line-height:26px;color:#2b2b2b;margin:10px 0;letter-spacing:2px;font-size:14px;word-spacing:2px">安装好扩展后，添加新脚本，将以下代码复制过去，注意改下 <code style="font-size:14px;word-wrap:break-word;margin:0 2px;background-color:rgba(27,31,35,5%);font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;word-break:break-all;color:#3594f7;background:RGBA(59,170,250,.1);padding:0 2px;border-radius:2px;height:21px;line-height:22px">const cfg</code> 的配置内容，后面注释有说明。</p><pre class=custom data-tool=mdnice编辑器 style="margin-top:10px;margin-bottom:10px;border-radius:5px;box-shadow:rgba(0,0,0,.55)0 2px 10px"><span style="display:block;background:url(https://my-wechat.mdnice.com/point.png);height:30px;width:100%;background-size:40px;background-repeat:no-repeat;background-color:#f8f8f8;margin-bottom:-7px;border-radius:5px;background-position:10px 10px"></span><code class=hljs style="overflow-x:auto;padding:16px;color:#333;display:-webkit-box;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;font-size:12px;-webkit-overflow-scrolling:touch;letter-spacing:0;padding-top:15px;background:#f8f8f8;border-radius:5px"><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;==UserScript==</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Upload&nbsp;to&nbsp;your&nbsp;picbed</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.1.0</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@description&nbsp;上传图片到你的图床</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@author&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;staugur</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@namespace&nbsp;&nbsp;&nbsp;https://www.saintic.com/</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://*</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@include&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://*</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@exclude&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://*.aliyun.com/*</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@run-at&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;document-start</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@grant&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GM_info</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@created&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2020-08-14</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@modified&nbsp;&nbsp;&nbsp;&nbsp;none</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@github&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https://github.com/staugur/userscript</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;@supportURL&nbsp;&nbsp;https://github.com/staugur/userscript/issues/</span><br><span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;==/UserScript==</span><br><br>(<span class=hljs-function style=line-height:26px><span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>function</span>&nbsp;(<span class=hljs-params style=line-height:26px></span>)&nbsp;</span>{<br><span class=hljs-meta style=color:#999;font-weight:700;line-height:26px>&nbsp;&nbsp;&nbsp;&nbsp;'use&nbsp;strict'</span>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>const</span>&nbsp;cfg&nbsp;=&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"hot_key"</span>:&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"ctrlKey"</span>,&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;允许的值:&nbsp;altKey&nbsp;shiftKey</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"api_url"</span>:&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>""</span>,&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;图片上传接口地址</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"token"</span>:&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>""</span>,&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;放在Header的&nbsp;`Authorization:&nbsp;Token&nbsp;&lt;here&gt;`&nbsp;用以验证</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"upload_name"</span>:&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"file"</span>,&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;上传字段，按照服务端要求设置</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"id"</span>:&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"picbed-menu"</span>,&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//&nbsp;不用改</span><br>&nbsp;&nbsp;&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;isObject&nbsp;=&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>v</span>&nbsp;=&gt;</span>&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>Object</span>.prototype.toString.call(v)&nbsp;===&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'[object&nbsp;Object]'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hasMenu&nbsp;=&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>()</span>&nbsp;=&gt;</span>&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>document</span>.getElementById(cfg.id)&nbsp;?&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>true</span>&nbsp;:&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>false</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getMenu&nbsp;=&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>()</span>&nbsp;=&gt;</span>&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>document</span>.getElementById(cfg.id),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hasSendingMenu&nbsp;=&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(hasMenu())&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;p&nbsp;=&nbsp;getMenu();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(p&nbsp;&amp;&amp;&nbsp;p.dataset.sendStatus&nbsp;===&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"sending"</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>return</span>&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>true</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>return</span>&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setBtnText&nbsp;=&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>text</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(text)&nbsp;getMenu().querySelector(<span class=hljs-string style=color:#d14;line-height:26px>"button"</span>).textContent&nbsp;=&nbsp;text;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeMenu&nbsp;=&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(hasMenu())&nbsp;getMenu().remove();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>function</span>&nbsp;<span class=hljs-title style=color:#900;font-weight:700;line-height:26px>upload</span>(<span class=hljs-params style=line-height:26px>src,&nbsp;opts</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(!src)&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>return</span>&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(!opts)&nbsp;opts&nbsp;=&nbsp;{};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(!isObject(opts))&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>return</span>&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>false</span>;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;data&nbsp;=&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>new</span>&nbsp;FormData();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.append(cfg.upload_name,&nbsp;src);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.append(<span class=hljs-string style=color:#d14;line-height:26px>'origin'</span>,&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>`userscript/<span class=hljs-subst style=color:#333;font-weight:400;line-height:26px>${GM_info.script.version}</span>`</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>Object</span>.assign(opts,&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-attr style=line-height:26px>url</span>:&nbsp;cfg.api_url,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-attr style=line-height:26px>method</span>:&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"POST"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-attr style=line-height:26px>headers</span>:&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-attr style=line-height:26px>Authorization</span>:&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>`Token&nbsp;<span class=hljs-subst style=color:#333;font-weight:400;line-height:26px>${cfg.token}</span>`</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-attr style=line-height:26px>data</span>:&nbsp;data,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;xhr&nbsp;=&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>new</span>&nbsp;XMLHttpRequest(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error&nbsp;=&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>typeof</span>&nbsp;opts.error&nbsp;===&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'function'</span>&nbsp;?&nbsp;opts.error&nbsp;:&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>msg</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>console</span>.error(msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.responseType&nbsp;=&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'json'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.open(opts.method,&nbsp;opts.url,&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>true</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>for</span>&nbsp;(<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;key&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>in</span>&nbsp;opts.headers)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.setRequestHeader(key,&nbsp;opts.headers[key]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.onloadstart&nbsp;=&nbsp;opts.start&nbsp;||&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.onload&nbsp;=&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>function</span>&nbsp;(<span class=hljs-params style=line-height:26px></span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>typeof</span>&nbsp;opts.success&nbsp;===&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'function'</span>&nbsp;&amp;&amp;&nbsp;opts.success(xhr.response);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.onerror&nbsp;=&nbsp;error(<span class=hljs-string style=color:#d14;line-height:26px>"请求错误"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>try</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.send(opts.data);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>catch</span>&nbsp;(e)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error(<span class=hljs-string style=color:#d14;line-height:26px>"网络异常"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>function</span>&nbsp;<span class=hljs-title style=color:#900;font-weight:700;line-height:26px>createMenu</span>(<span class=hljs-params style=line-height:26px>e,&nbsp;onClick</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(hasSendingMenu())&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>return</span>&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;removeMenu();<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;src&nbsp;=&nbsp;e.target.src;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;wrapperCss&nbsp;=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"position:&nbsp;absolute"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>`left:&nbsp;<span class=hljs-subst style=color:#333;font-weight:400;line-height:26px>${e.pageX}</span>px`</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>`top:<span class=hljs-subst style=color:#333;font-weight:400;line-height:26px>${e.pageY}</span>px`</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"z-index:&nbsp;9999999"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"width:&nbsp;200px"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"background-color:&nbsp;#fff"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"color:&nbsp;#000"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"text-align:&nbsp;center"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"border:&nbsp;1px&nbsp;#409eff&nbsp;solid"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"font-size:&nbsp;14px"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"line-height:&nbsp;24px"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"overflow:&nbsp;hidden"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"white-space:&nbsp;nowrap"</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>`text-overflow:&nbsp;".../<span class=hljs-subst style=color:#333;font-weight:400;line-height:26px>${src.split(<span class=hljs-string style=color:#d14;line-height:26px>"/"</span>).slice(<span class=hljs-number style=color:teal;line-height:26px>-1</span>)[<span class=hljs-number style=color:teal;line-height:26px>0</span>]}</span>"`</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;wrapper&nbsp;=&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>document</span>.createElement(<span class=hljs-string style=color:#d14;line-height:26px>'div'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrapper.style.cssText&nbsp;=&nbsp;wrapperCss.join(<span class=hljs-string style=color:#d14;line-height:26px>";"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrapper.textContent&nbsp;=&nbsp;src;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrapper.setAttribute(<span class=hljs-string style=color:#d14;line-height:26px>'id'</span>,&nbsp;cfg.id);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;btnCss&nbsp;=&nbsp;[<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'display:&nbsp;block'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'margin:&nbsp;0&nbsp;auto'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'width:&nbsp;100%'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'padding:&nbsp;5px&nbsp;10px'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'font-size:&nbsp;12px'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'background-color:&nbsp;#fff'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'color:&nbsp;#409eff'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'border:&nbsp;0px'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'cursor:&nbsp;pointer'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'user-select:&nbsp;none'</span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;btn&nbsp;=&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>document</span>.createElement(<span class=hljs-string style=color:#d14;line-height:26px>'button'</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.style.cssText&nbsp;=&nbsp;btnCss.join(<span class=hljs-string style=color:#d14;line-height:26px>";"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.textContent&nbsp;=&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"点击上传"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.onclick&nbsp;=&nbsp;onClick;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrapper.appendChild(btn);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>document</span>.body.appendChild(wrapper);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>document</span>.addEventListener(<span class=hljs-string style=color:#d14;line-height:26px>'mousedown'</span>,&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>function</span>&nbsp;(<span class=hljs-params style=line-height:26px>e</span>)&nbsp;</span>{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//恢复默认右键菜单</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>document</span>.oncontextmenu&nbsp;=&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//在图片上使用&nbsp;快捷键+鼠标右击&nbsp;打开自定义菜单</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(e[cfg.hot_key]&nbsp;===&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>true</span>&nbsp;&amp;&amp;&nbsp;e.button&nbsp;===&nbsp;<span class=hljs-number style=color:teal;line-height:26px>2</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(e.target.tagName.toLowerCase()&nbsp;===&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'img'</span>&nbsp;&amp;&amp;&nbsp;e.target.src)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//确定选中图片右键，打开上传菜单</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-built_in style=color:#0086b3;line-height:26px>document</span>.oncontextmenu&nbsp;=&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>()</span>&nbsp;=&gt;</span>&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;createMenu(e,&nbsp;()&nbsp;=&gt;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>let</span>&nbsp;menu&nbsp;=&nbsp;getMenu();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu.querySelector(<span class=hljs-string style=color:#d14;line-height:26px>"button"</span>).onclick&nbsp;=&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>null</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu.querySelector(<span class=hljs-string style=color:#d14;line-height:26px>"button"</span>).style.cursor&nbsp;=&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>'text'</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(<span class=hljs-regexp style=color:#009926;line-height:26px>/^(?:blob:|filesystem:)/</span>.test(e.target.src))&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setBtnText(<span class=hljs-string style=color:#d14;line-height:26px>"不支持的图片格式"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>return</span>&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>false</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;upload(e.target.src,&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-attr style=line-height:26px>start</span>:&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>()</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu.dataset.sendStatus&nbsp;=&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"sending"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setBtnText(<span class=hljs-string style=color:#d14;line-height:26px>"正在上传..."</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-attr style=line-height:26px>success</span>:&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>res</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(res.code&nbsp;===&nbsp;<span class=hljs-number style=color:teal;line-height:26px>0</span>)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu.dataset.sendStatus&nbsp;=&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"success"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setBtnText(<span class=hljs-string style=color:#d14;line-height:26px>"上传成功"</span>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu.dataset.sendStatus&nbsp;=&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"fail"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setBtnText(res.msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-attr style=line-height:26px>error</span>:&nbsp;<span class=hljs-function style=line-height:26px><span class=hljs-params style=line-height:26px>msg</span>&nbsp;=&gt;</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;menu.dataset.sendStatus&nbsp;=&nbsp;<span class=hljs-string style=color:#d14;line-height:26px>"error"</span>;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setBtnText(msg);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>else</span>&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-comment style=color:#998;font-style:italic;line-height:26px>//非面板内的点击/右击等操作（且无发送中状态）则关闭菜单</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(e.target.id&nbsp;!==&nbsp;cfg.id&nbsp;&amp;&amp;&nbsp;e.target.parentElement.id&nbsp;!==&nbsp;cfg.id)&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class=hljs-keyword style=color:#333;font-weight:700;line-height:26px>if</span>&nbsp;(!hasSendingMenu())&nbsp;removeMenu();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;<span class=hljs-literal style=color:teal;line-height:26px>true</span>);<br>})();<br></code></pre></section><br><center>·End·</center></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Hiroshi.tao</span></p><p class=copyright-item><span>Link:</span>
<a href=https://blog.saintic.com/blog/285.html>https://blog.saintic.com/blog/285.html</span></p><p class="copyright-item lincese">本文采用 <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a> 进行许可</p></div><div class=post-tags><section><i class="saintic-icon saintic-icon-tag"></i>Tag(s):
<a href=/tags/js.html rel=tag class=post-tags-link>#js</a></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://blog.saintic.com>home</a></span></section></div><div class=post-nav><a href=https://blog.saintic.com/blog/284.html class=prev rel=prev title=为Isso评论系统添加微信审核功能><i class="saintic-icon saintic-icon-angle-left"></i>&nbsp;为Isso评论系统添加微信审核功能</a>
<a href=https://blog.saintic.com/blog/286.html class=next rel=next title="封装Semantic-UI Button作为Vue组件">封装Semantic-UI Button作为Vue组件&nbsp;<i class="saintic-icon saintic-icon-angle-right"></i></a></div><div class=post-comment><div id=utteranc-container><script src=https://utteranc.es/client.js repo=staugur/staugur.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2021</span>
<span class=with-love><i class="saintic-icon saintic-icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://blog.saintic.com>Hiroshi.tao</a> |</span>
<a href=http://www.miibeian.gov.cn/ target=_blank rel="external nofollow">京ICP备14058611号</a> |
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/Mogeko/Mogege target=_blank rel="external nofollow">Mogege</a></span></div></footer><script defer src=/js/vendor_main.min.js></script><script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage()</script>>
<script defer src=https://blog.saintic.com/js/_custom.js></script></div></body></html>