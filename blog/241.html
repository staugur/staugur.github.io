<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=author content="Hiroshi.tao"><meta name=description content="Hiroshi.tao の 网络日志"><meta name=keywords content="SaintIC,staugur,Linux,DevOps,python"><link rel=prev href=https://blog.saintic.com/blog/240.html><link rel=next href=https://blog.saintic.com/blog/242.html><link rel=canonical href=https://blog.saintic.com/blog/241.html><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Api接口签名验证(Flask) | 陶先森de博客</title><meta name=title content="Api接口签名验证(Flask) | 陶先森de博客"><link rel=stylesheet href=/css/main.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.saintic.com"},"articleSection":"blog","name":"Api接口签名验证(Flask)","headline":"Api接口签名验证(Flask)","description":"前文 在使用Api场景的系统交互时，​使用API签名，即保证请求的数据正确性和接口安全，又能识别API调用者的身份。 以下以一种常见方式演示： 公","inLanguage":"zh-cn","author":"Hiroshi.tao","creator":"Hiroshi.tao","publisher":"Hiroshi.tao","accountablePerson":"Hiroshi.tao","copyrightHolder":"Hiroshi.tao","copyrightYear":"2017","datePublished":"2017-11-21 00:00:00 \u002b0000 UTC","dateModified":"2017-11-21 00:00:00 \u002b0000 UTC","url":"https:\/\/blog.saintic.com\/blog\/241.html","wordCount":"1101","keywords":["python","陶先森de博客"]}</script></head><body><div class=wrapper><nav class=navbar><progress class=content_progress max=0 value=0></progress><div class=container><div class="navbar-header header-back2home-logo"><span class=logo_mark>>$</span>
<a href=https://blog.saintic.com><span class=logo_text>cd /home/</span>
<span class=logo_cursor></span></a></div><div class=navbar-right><span class=menu><a class=menu-item href=/blog.html title>Posts</a>
<a class=menu-item href=/categories.html title>Categories</a>
<a class=menu-item href=/tags.html title>Tags</a>
<a class=menu-item href=/link.html title>Links</a>
<a class=menu-item href="https://www.baidu.com/s?wd=site:blog.saintic.com" title>Search</a>
<a class=menu-item href=/about.html title=About>About</a>
<span class=divide></span><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></span></div></div></nav><nav class=navbar-mobile id=nav-mobile style=display:none><progress class=content_progress max=0 value=0></progress><div class=container><div class=navbar><div class="navbar-header header-logo"><a href=https://blog.saintic.com>陶先森de博客</a></div><div class=navbar-right><div><a href=javascript:void(0); class=theme-switch><i class="iconfont icon-dark-mode"></i></a></div><div class=menu-toggle><span></span><span></span><span></span></div></div></div><div class=menu id=mobile-menu><nav class=mb-md><a class=menu-item href=/blog.html title><h3>Posts</h3><div class=menu-active></div></a><a class=menu-item href=/categories.html title><h3>Categories</h3><div class=menu-active></div></a><a class=menu-item href=/tags.html title><h3>Tags</h3><div class=menu-active></div></a><a class=menu-item href=/link.html title><h3>Links</h3><div class=menu-active></div></a><a class=menu-item href="https://www.baidu.com/s?wd=site:blog.saintic.com" title><h3>Search</h3><div class=menu-active></div></a><a class=menu-item href=/about.html title=About><h3>About</h3><div class=menu-active></div></a></nav></div></div></nav><main class=main><div class=container><article class=post-warp itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline">Api接口签名验证(Flask)</h1><div class=post-meta>Written by <a itemprop=name href=https://blog.saintic.com rel=author>Hiroshi.tao</a> with ♥
<span class=post-time>on <time datetime=2017-11-21 itemprop=datePublished>November 21, 2017</time></span>
in
<i class="iconfont icon-folder"></i><span class=post-category><a href=https://blog.saintic.com/categories/%E5%BC%80%E5%8F%91.html>开发</a></span>
<span class=post-word-count>1101 words</span></div></header><div class=post-content><h3 id=前文><strong>前文</strong></h3><blockquote><pre><code>在使用Api场景的系统交互时，​使用API签名，即保证请求的数据正确性和接口安全，又能识别API调用者的身份。 
</code></pre></blockquote><pre><code>以下以一种常见方式演示：

    公共参数加请求参数排序后，再加上密钥，最后使用诸如md5、hmac等加密生成signature值，作为请求参数。

这种签名方式：

    牵一发而动全身，公共参数包含时间戳参数亦可防止拦截URL多次请求，包含accesskey\_id以识别调用者，较有通用性。

更多介绍参考：

    简书：&lt;http://www.jianshu.com/p/d47da77b6419&gt;

    阿里云：&lt;https://help.aliyun.com/document_detail/54229.html&gt;
</code></pre><h3 id=示例><strong>示例</strong></h3><h5 id=github-flask-apisign-demohttpsgithubcomstaugurflask-apisign-demo>GitHub flask-apiSign-demo：<a href=https://github.com/staugur/flask-apiSign-demo>https://github.com/staugur/flask-apiSign-demo</a></h5><h4 id=使用>使用</h4><p><code>cd server;pip install \-r requirements.txt</code><br><code>python main.py</code></p><h4 id=客户端>客户端</h4><h5 id=pythonshell>Python、Shell</h5><p><img src=https://static.saintic.com/EauDouce/blog/201806061955117008.png alt=1 loading=lazy></p><h5 id=javascripthtml>JavaScript(HTML)</h5><p><img src=https://static.saintic.com/EauDouce/blog/201806061955204291.png alt=2 loading=lazy></p><h4 id=签名描述>签名描述</h4><h5 id=一起因>一、起因</h5><p>为了实现基本的防抓取机制，对绝大多数采用了 Api 签名验证，在保证签名秘钥不泄露的前提下，具有一定的数据抓取防御能力。</p><ol><li><p>请求参数是否被篡改；</p></li><li><p>请求来源是否合法；</p></li><li><p>请求是否具有唯一性。</p></li></ol><h5 id=二经过>二、经过</h5><ol><li><p>前提准备</p><p>接口提供方生成用户密钥，包含：</p><p>1.1 accesskey_id, 标识用户</p><p>1.2 accesskey_secret, 用户加密串(严格保管，仅用于加密不参与通信)</p></li><li><p>公共参数</p><p>2.1 accesskey_id, 标识用户</p><p>2.2 version, 后端接口版本号</p><p>2.3 timestamp, 10位时间戳(客户端生成时间戳可以适当减几秒)</p><p>2.4 signature, uri请求参数签名(除signature外所有)</p><h1 id=另可以定义其他参数比如signmethod>另可以定义其他参数，比如signMethod</h1></li><li><p>签名过程</p><p>3.1.对除签名外的所有请求参数按key做的升序排列。</p><p><code>例如：有b=2一个私有参数，另加上公共参数后，按key排序后为：accesskey_id、b、timestamp、version</code></p><p>3.2 把排序后的参数以"参数名=参数值&&ldquo;的形式连接，末尾再加上"accesskey_secret"值，得到拼装字符串。</p><p><code>例如：accesskey_id=test&b=2×tamp=1511232761&version=v1&accesskey_secret</code></p><p>3.3 将上一步得到的字符串MD5加密并转化为大写。</p><p><code>例如：signature=F833B331E572FD9D3D64A8D0737490B0</code></p><p>3.4 最终请求示例。</p><p><code>timestamp=1511232761&b=2&version=v1&accesskey_id=test&signature=F833B331E572FD9D3D64A8D0737490B0</code></p></li><li><p>验证请求：</p><p>4.1 验证版本(非必要)</p><p>4.2 验证时间戳是否有效(小于等于服务器时间戳且在30s之内请求有效)</p><p>4.3 验证accesskey_id是否有效</p><p>4.4 验证签名</p></li></ol><h4 id=四参考>四、参考</h4><ol><li><a href=http://www.hello1010.com/api-sign>API接口签名验证(详细描述主流签名方式)</a></li><li><a href=https://github.com/Eliacy/YYMiOS/wiki/Api%EF%BC%9A%E7%AD%BE%E5%90%8D%E9%AA%8C%E8%AF%81%E6%9C%BA%E5%88%B6>Api：签名验证机制(提及关于POST签名说明)</a><br></li></ol><center>·End·</center></div><div class=post-copyright><p class=copyright-item><span>Author:</span>
<span>Hiroshi.tao</span></p><p class=copyright-item><span>Link:</span>
<a href=https://blog.saintic.com/blog/241.html>https://blog.saintic.com/blog/241.html</span></p><p class="copyright-item lincese">本文采用 <a rel=license href=http://creativecommons.org/licenses/by-nc/4.0/ target=_blank>知识共享署名-非商业性使用 4.0 国际许可协议</a> 进行许可</p></div><div class=post-tags><section><i class="iconfont icon-tag"></i>Tag(s):
<a href=/tags/python.html rel=tag class=post-tags-link>#python</a></section><section><a href=javascript:window.history.back();>back</a></span> ·
<span><a href=https://blog.saintic.com>home</a></span></section></div><div class=post-nav><a href=https://blog.saintic.com/blog/240.html class=prev rel=prev title=开放获取Bing每日背景图片接口><i class="iconfont icon-left"></i>&nbsp;开放获取Bing每日背景图片接口</a>
<a href=https://blog.saintic.com/blog/242.html class=next rel=next title=分享python基于onetimepass的双因素身份验证(2FA)>分享python基于onetimepass的双因素身份验证(2FA)&nbsp;<i class="iconfont icon-right"></i></a></div><div class=post-comment><div id=utteranc-container><script src=https://utteranc.es/client.js repo=staugur/staugur.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></article></div></main><footer class=footer><div class=copyright>&copy;
<span itemprop=copyrightYear>2017 - 2021</span>
<span class=with-love><i class="iconfont icon-love"></i></span><span class=author itemprop=copyrightHolder><a href=https://blog.saintic.com>Hiroshi.tao</a> |</span>
<a href=http://www.miibeian.gov.cn/ target=_blank rel="external nofollow">京ICP备14058611号</a> |
<span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow">Hugo</a> & <a href=https://github.com/Mogeko/Mogege target=_blank rel="external nofollow">Mogege</a></span></div></footer><script defer src=/js/vendor_main.min.js></script><script src=https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin=anonymous></script><script>pangu.spacingPage()</script></div></body></html>